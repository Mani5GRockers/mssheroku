[![Slam](https://gitlab.awslink.in/api/logoposter.jpg)](https://youtu.be/Pk_TthHfLeE)

# Slam Mirror Bot
![GitHub Repo stars](https://img.shields.io/github/stars/SlamDevs/slam-mirrorbot?color=blue&style=flat)
![GitHub forks](https://img.shields.io/github/forks/SlamDevs/slam-mirrorbot?color=green&style=flat)
![GitHub contributors](https://img.shields.io/github/contributors/SlamDevs/slam-mirrorbot?style=flat)
![GitHub watchers](https://img.shields.io/github/watchers/SlamDevs/slam-mirrorbot)
![Docker Pulls](https://img.shields.io/docker/pulls/breakdowns/mega-sdk-python?label=Docker%20Pull)
[![Channel](https://img.shields.io/badge/Join%20Channel-!-red)](https://t.me/SlamMirrorUpdates)

**Slam Mirror Bot** is a _multipurpose_ Telegram Bot written in Python for mirroring files on the Internet to our beloved Google Drive. Based on [python-aria-mirror-bot](https://github.com/lzzy12/python-aria-mirror-bot)

#New Updates

#Fix https://awslink.in/slam  https://t.me/SlamMirrorUpdates 07-09-2021 Last Updates.

# HOW to Add Torrnet files:

     * torrent_searchs.py, custom_filters.py, requirements.txt, add main py only mirrorx {from telegram import ParseMode}

     * Trrent Comment and api site url edit and add torrent_searchs.py, __main__.py, bot_commands.py, config.env Done.

## MY EDIT PAGE
- BOT COMMENTS change me - https://github.com/mani66660/slam-mirrorbot-new/edit/master/bot/helper/telegram_helper/bot_commands.py

- /help BOT Start Message, HELP COMMENTS INFO, STATS NEW STYLE, https://github.com/mani66660/slam-tg-mirror-bot/blob/master/bot/__main__.py

- /mirror FINISHED_PROGRESS_STR, UNFINISHED_PROGRESS_STR, 🟩🟨, ╔●╟●╚●╚═●, MirrorStatus, ✥═══ @Mani5GRockers ═══✥, 〘〙, STATUS_LIMIT ⬅️➡️, Uploader - https://github.com/mani66660/slam-tg-mirror-bot/blob/master/bot/helper/ext_utils/bot_utils.py

- /mirror ✥════ @Mani5GRockers ════✥, hide cpu, ram, disk - https://github.com/mani66660/slam-tg-mirror-bot/edit/master/bot/helper/telegram_helper/message_utils.py

- /mirror stop url msg, mirror wrong url, name replay msg    sendMessage('❌ Opps 🤦! Not Like That ❌\n\n💁‍♀️ 𝐇𝐎𝐖 𝐓𝐎 𝐌𝐈𝐑𝐑𝐎𝐑 ?\n\n📖 Read Document 📖\n\n 👉 https://awslink.in/awsmirrorzonehelp', bot, update), 👤 Uploader: </b>👉 {uname}\n\n⛔ 𝘿𝙤 𝙣𝙤𝙩 𝙨𝙝𝙖𝙧𝙚 𝙄𝙣𝙙𝙚𝙭 𝙇𝙞𝙣𝙠, download has been stopped</b>:\n\n🎄 <b>Reason - https://github.com/mani66660/slam-tg-mirror-bot/blob/master/bot/modules/mirror.py

- /watch commment msg added - https://github.com/mani66660/slam-tg-mirror-bot/blob/master/bot/modules/watch.py
- /authorize Emoji logo added- https://github.com/mani66660/slam-tg-mirror-bot/blob/master/bot/modules/authorize.py
- /tshelp - https://github.com/mani66660/slam-tg-mirror-bot/blob/master/bot/modules/torrent_search.py
- 
- 
- 
  
    
    
    ## Bot commands to be set in [@BotFather](https://t.me/BotFather)
```
help - ★ Get Detailed Help ★
dl - ★ 🧲 Start Mirroring using qBittorrent ★
mir - ★ Start Mirroring ★
ytdl - ★ Mirror Youtube-dl supported link ★
clone - ★ Copy file/folder to Drive ★
leech - ★ leech video or file ★
dlleech - ★ magnet leech video or file ★
setthumb - ★ set thumbnail pictures ★
leechset - ★ Leech Setting ★
tar - ★ Start mirroring and upload as .tar ★
zip - ★ Start mirroring and upload as .zip ★
unzip - ★ Extract files ★
qbtar - ★ 🧲 Start mirroring and upload as .tar using qb ★
qbzip - ★ 🧲 Start mirroring and upload as .zip using qb ★
qbunzip - ★ 🧲 Extract files using qBittorrent ★
count - ★ Count file/folder of Drive link ★
tarytdl - ★ Mirror Youtube playlist link and upload as .tar ★
zipytdl - ★ Mirror Youtube playlist link and upload as .zip ★
status - ★ Get Mirror Status message ★
stats - ★ 📊 Bot Usage Stats ★
search - ★ 🔍 File Name Searches files in Drive ★
speedtest - ★ 🚀 Bot Speed Testing ★
cancel - ★ 🚫 Cancel a task ★
cancelall - ★ 🚫 Cancel all tasks ★
restart - ★ ♻️ Restart the Bot [owner/sudo only] ★
ts - ★ 🧲 Torrent Search File Name ★
```  
  ## multi Bot commands
    
## Bot commands to be set in [@BotFather](https://t.me/BotFather)
```
help - ★ Get Detailed Help ★
mirror - ★ Start Mirroring ★
tar - ★ Start mirroring and upload as .tar ★
zip - ★ Start mirroring and upload as .zip ★
unzip - ★ Extract files ★
qbmirror - ★ 🧲 Start Mirroring using qBittorrent ★
qbtar - ★ 🧲 Start mirroring and upload as .tar using qb ★
qbzip - ★ 🧲 Start mirroring and upload as .zip using qb ★
qbunzip - ★ 🧲 Extract files using qBittorrent ★
clone - ★ Copy file/folder to Drive ★
count - ★ Count file/folder of Drive link ★
watch - ★ Mirror Youtube-dl supported link ★
tarwatch - ★ Mirror Youtube playlist link and upload as .tar ★
zipwatch - ★ Mirror Youtube playlist link and upload as .zip ★
status - ★ Get Mirror Status message ★
stats - ★ 📊 Bot Usage Stats ★
search - ★ 🔍 File Name Searches files in Drive ★
speedtest - ★ 🚀 Bot Speed Testing ★
cancel - ★ 🚫 Cancel a task ★
cancelall - ★ 🚫 Cancel all tasks ★
restart - ★ ♻️ Restart the Bot [owner/sudo only] ★
tshelp - ★ 🧲 Torrent Search File Name ★
tshelp0 - ★ 🧲 Torrent Search File Name ★
```  
  ## multi Bot commands
``` 
help1 - ★ Get Detailed Help ★
mirror1 - ★ Start Mirroring ★
tar1 - ★ Start mirroring and upload as .tar ★
zip1 - ★ Start mirroring and upload as .zip ★
unzip1 - ★ Extract files ★
qbmirror1 - ★ 🧲 Start Mirroring using qBittorrent ★
qbtar1 - ★ 🧲 Start mirroring and upload as .tar using qb ★
qbzip1 - ★ 🧲 Start mirroring and upload as .zip using qb ★
qbunzip1 - ★ 🧲 Extract files using qBittorrent ★
clone1 - ★ Copy file/folder to Drive ★
count1 - ★ Count file/folder of Drive link ★
watch1 - ★ Mirror Youtube-dl supported link ★
tarwatch1 - ★ Mirror Youtube playlist link and upload as .tar ★
zipwatch1 - ★ Mirror Youtube playlist link and upload as .zip ★
status1 - ★ Get Mirror Status message ★
stats - ★ 📊 Bot Usage Stats ★
search - ★ 🔍 File Name Searches files in Drive ★
speedtest - ★ 🚀 Bot Speed Testing ★
cancel1 - ★ 🚫 Cancel a task ★
cancelall1 - ★ 🚫 Cancel all tasks ★
restart1 - ★ ♻️ Restart the Bot [owner/sudo only] ★
tshelp1 - ★ 🧲 Torrent Search File Name ★
tshelp11 - ★ 🧲 Torrent Search1 File Name ★ 
```
  ## CONFIG.env
```     
STATS_COMMAND = 'stats'
MIRROR_COMMAND = 'mirror'
UNZIPMIRROR_COMMAND = 'unzip'
ZIPMIRROR_COMMAND = 'zip'
TARMIRROR_COMMAND = 'tar'
QBMIRROR_COMMAND = 'qbmirror'
QBUNZIPMIRROR_COMMAND = 'qbunzip'
QBZIPMIRROR_COMMAND = 'qbzip'
QBTARMIRROR_COMMAND = 'qbtar'
CANCELMIRROR_COMMAND = 'cancel'
CANCELALL_COMMAND = 'cancelall'
STATUS_COMMAND = 'status'
RESTART_COMMAND = 'restart'
HELP_COMMAND = 'help'
LOG_COMMAND = 'log'
CLONE_COMMAND = 'clone'
COUNT_COMMAND = 'count'
WATCH_COMMAND = 'watch'
ZIPWATCH_COMMAND = 'zipwatch'
TARWATCH_COMMAND = 'tarwatch'
DELETE_COMMAND = 'del'
SHELL_COMMAND = 'shell'
EXECHELP_COMMAND = 'exechelp'
TSHELP_COMMAND = 'tshelp'
TSHELP1_COMMAND = 'tshelp1'
RMSUDO_COMMAND = 'rmsudo'
ADDSUDO_COMMAND = 'addsudo'
AUTHORIZEDUSERS_COMMAND = 'alluser'
AUTHORIZE_COMMAND = 'auth'
UNAUTHORIZE_COMMAND = 'unauth'
LIST_COMMAND = 'search'
SPEED_COMMAND = 'speedtest'
PING_COMMAND = 'ping'
START_COMMAND = 'start'  
 ```   
  ## BOT COMMENT.py
```   
import os

def getCommand(name: str, command: str):
    try:
        if len(os.environ[name]) == 0:
            raise KeyError
        return os.environ[name]
    except KeyError:
        return command
class _BotCommands:
    def __init__(self):
        self.StartCommand = getCommand('START_COMMAND', 'starts')
        self.MirrorCommand = getCommand('MIRROR_COMMAND', 'mirrors')
        self.UnzipMirrorCommand = getCommand('UNZIPMIRROR_COMMAND', 'unzipmirror')
        self.TarMirrorCommand = getCommand('TARMIRROR_COMMAND', 'tarmirror')
        self.ZipMirrorCommand = getCommand('ZIPMIRROR_COMMAND', 'zipmirror')
        self.CancelMirror = getCommand('CANCELMIRROR_COMMAND', 'cancels')
        self.CancelAllCommand = getCommand('CANCELALL_COMMAND', 'cancelalls')
        self.ListCommand = getCommand('LIST_COMMAND', 'searchs')
        self.StatusCommand = getCommand('STATUS_COMMAND', 'statuss')
        self.AuthorizedUsersCommand = getCommand('AUTHORIZEDUSERS_COMMAND', 'allusers')
        self.AuthorizeCommand = getCommand('AUTHORIZE_COMMAND', 'auths')
        self.UnAuthorizeCommand = getCommand('UNAUTHORIZE_COMMAND', 'unauths')
        self.AddSudoCommand = getCommand('ADDSUDO_COMMAND', 'addsudos')
        self.RmSudoCommand = getCommand('RMSUDO_COMMAND', 'rmsudos')
        self.PingCommand = getCommand('PING_COMMAND', 'pings')
        self.RestartCommand = getCommand('RESTART_COMMAND', 'restarts')
        self.StatsCommand = getCommand('STATS_COMMAND', 'statss')
        self.HelpCommand = getCommand('HELP_COMMAND', 'helps')
        self.LogCommand = getCommand('LOG_COMMAND', 'logs')
        self.SpeedCommand = getCommand('SPEED_COMMAND', 'speedtests')
        self.CloneCommand = getCommand('CLONE_COMMAND', 'clones')
        self.CountCommand = getCommand('COUNT_COMMAND', 'counts')
        self.WatchCommand = getCommand('WATCH_COMMAND', 'watchs')
        self.TarWatchCommand = getCommand('TARWATCH_COMMAND', 'tarwatchs')
        self.ZipWatchCommand = getCommand('ZIPWATCH_COMMAND', 'zipwatches')
        self.QbMirrorCommand = getCommand('QBMIRROR_COMMAND', 'qbmirrors')
        self.QbUnzipMirrorCommand = getCommand('QBUNZIPMIRROR_COMMAND', 'qbunzipmirrors')
        self.QbTarMirrorCommand = getCommand('QBTARMIRROR_COMMAND', 'qbtarmirrors')
        self.QbZipMirrorCommand = getCommand('QBZIPMIRROR_COMMAND', 'qbzipmirrors')
        self.DeleteCommand = getCommand('DELETE_COMMAND', 'dels')
        self.ShellCommand = getCommand('SHELL_COMMAND', 'shells')
        self.ExecHelpCommand = getCommand('EXECHELP_COMMAND', 'exechelps')
        self.TsHelpCommand = getCommand('TSHELP_COMMAND', 'tshelps')
        self.TsHelp1Command = getCommand('TSHELP1_COMMAND', 'tshelpss')

BotCommands = _BotCommands()  
```   
  
## Deploying on Heroku using Ubuntu:

- Install [Heroku cli](https://devcenter.heroku.com/articles/heroku-cli)
- Login into your heroku account with command:
```
sudo apt-get update
sudo apt-get install
sudo apt install python                #Downloading...
sudo apt install python3-pip
sudo pip install pyrogram
pip install telegraph
sudo python3 -m pip install --upgrade pip
sudo apt install nodejs
sudo apt install git
sudo pip3 install docker-compose
sudo apt install npm                   #Downloading...
sudo npm install -g heroku             #Downloading...
```
```
heroku login
heroku create awsxxxbot                #Change awsxxxbot new app Name your choose
cd
git clone https://github.com/mani66660/mirrorxbot
ls
cd mirrorxbot                          #Change Repo Name or repo remove cmd $rm -rf MirrorX
heroku git:remote -a awsxxxbot         #Change awsxxxbot new app Name
sudo pip3 install -r requirements.txt
heroku stack:set container           only one app deplay work  #Free Dynos install   or $heroku stack:set container -a awsxxxbot    multi app use
heroku addons:create heroku-postgresql                                    #Create heroku-postgresql database
git add -f credentials.json token.pickle config.env heroku.yml
git commit -m "Added Creds."
git config --global user.email heroku31@tempmail.awslink.in               #Change heroku email id set your email id
git config --global user.name Your Name                                   #Change your Name [MAIN Awssmbot]
git commit -m "First Deployment"
git push heroku master --force                    $git push heroku archived --force    # not working master change archived beta

heroku ps:scale worker=0
heroku ps:scale worker=1
    
heroku logs
    
apt --fix-broken install any error use this fix    
```
```
  Install the Heroku CLI
Download and install the Heroku CLI.

If you haven't already, log in to your Heroku account and follow the prompts to create a new SSH public key.

$ heroku login

Create a new Git repository
Initialize a git repository in a new or existing directory

$ cd
$ ls
$ rm -rf mirrorxbot       # old repo remove
$ git clone https://github.com/mani66660/mirrorxbot
$ ls
$ cd mirrorxbot                          #Change Repo Name or repo remove cmd $rm -rf MirrorX
$ git init
$ heroku git:remote -a mirrorxbot

Deploy your application
Commit your code to the repository and deploy it to Heroku using Git.

$ git add .
$ git commit -am "make it better"
$ git push heroku master

You can now change your main deploy branch from "master" to "main" for both manual and automatic deploys, please follow the instructions here.
Existing Git repository
For existing repositories, simply add the heroku remote

$ heroku git:remote -a awsmirrorzone0 
```

## How to Add Torrent Search Extra Bot Addons
- bot/modules/torrent_search.py add file - torrent_search.py
- bot/helper/custom_filters.py add file - custom_filters.py
- Add torrent_search (bot/__main__.py) 20 line add - from .modules import authorize, list, cancel_mirror, mirror_status, mirror, clone, watch, shell, eval, torrent_search, delete, speedtest, count, reboot
- /{BotCommands.TsHelpCommand}: Get help for Torrent search module        - 140 line bot comments msg
- /{BotCommands.TsHelpCommand}: Get help for Torrent search module        - 172 line bot comments msg
- (f'{BotCommands.TsHelpCommand}','Get help for Torrent search module')   - 200 line bot comment set
- bot/helper/telegram_helper/bot_commands.py      self.TsHelpCommand = 'tshelp'     - 30line last bot comment set
- docker-compose.yml - 10,11 line add space
- DONE.

- Torrent search Supported:
```
nyaa.si, sukebei, 1337x, piratebay,
tgx, yts, eztv, torlock, rarbg
```
https://github.com/digidigido3/slam-mirrorbot/blob/master/bot/modules/search.py  and add 165 line
```
TORRENT_API_URL = 'https://api.linkstore.eu.org/api'

torrents_dict = {
    '1337x': {'source': f"{TORRENT_API_URL}/api/1337x/", 'result_str': RESULT_STR_1337X},
    'piratebay': {'source': f"{TORRENT_API_URL}/api/piratebay/", 'result_str': RESULT_STR_PIRATEBAY},
    'tgx': {'source': f"{TORRENT_API_URL}/api/tgx/", 'result_str': RESULT_STR_TGX},
    'yts': {'source': f"{TORRENT_API_URL}/api/yts/", 'result_str': RESULT_STR_YTS},
    'eztv': {'source': f"{TORRENT_API_URL}/api/eztv/", 'result_str': RESULT_STR_EZTV},
    'torlock': {'source': f"{TORRENT_API_URL}/api/torlock/", 'result_str': RESULT_STR_TORLOCK},
    'rarbg': {'source': f"{TORRENT_API_URL}/api/rarbg/", 'result_str': RESULT_STR_RARBG},
    'ts': {'source': f"{TORRENT_API_URL}/api/all/", 'result_str': RESULT_STR_ALL}
}
```
```
torrents_dict = {
    '1337x': {'source': "https://api.eunhamirror.repl.co/api/1337x/", 'result_str': RESULT_STR_1337},
    'piratebay': {'source': "https://api.eunhamirror.repl.co/api/piratebay/", 'result_str': RESULT_STR_PIRATEBAY},
    'tgx': {'source': "https://api.eunhamirror.repl.co/api/tgx/", 'result_str': RESULT_STR_TGX},
    'yts': {'source': "https://api.eunhamirror.repl.co/api/yts/", 'result_str': RESULT_STR_YTS},
    'eztv': {'source': "https://api.eunhamirror.repl.co/api/eztv/", 'result_str': RESULT_STR_EZTV},
    'torlock': {'source': "https://api.eunhamirror.repl.co/api/torlock/", 'result_str': RESULT_STR_TORLOCK},
    'rarbg': {'source': "https://api.eunhamirror.repl.co/api/rarbg/", 'result_str': RESULT_STR_RARBG},
    'ts': {'source': "https://api.eunhamirror.repl.co/api/all/", 'result_str': RESULT_STR_ALL}
}
```

# Features:
<details>
    <summary><b>Click Here For More Details</b></summary>

  This is a Telegram Bot written in Python for mirroring files on the Internet to your Google Drive or Telegram. Based on [python-aria-mirror-bot](https://github.com/lzzy12/python-aria-mirror-bot)

# Features:

## By [anasty17](https://github.com/anasty17)
In each single file there is a major change from base code, it's almost totaly different. Here some of features and fixes that I remember.
### qBittorrent
- Qbittorrent support
- Select files from Torrent before and while downloading
- Seed torrents to specific ratio and time
### Aria2c
- Select files from Torrent before and while downloading
- Seed torrents to specific ratio and time
- Netrc support
- Direct link authentication for specific link while using the bot (it will work even if only username or password)
- Improve aria.sh
- Fix all download listener functions and status
### Leech
- Leech support
- Splitting
- Thumbnail for each user
- Set upload as document or as media for each user
- 4GB file upload with premium account
- Upload all files to specific superGroup/channel.
### Google
- Stop duplicates for all tasks except yt-dlp tasks
- Download G-Drive links
- Counting files/folders from Google Drive link
- Search in multiple Drive folder/TeamDrive
- Recursive Search (only with `root` or TeamDrive ID, folder ids will be listed with non-recursive method)
- Use Token.pickle if file not found with Service Account, for all Gdrive functions
- List result in html file instead of telegraph or telegram message to avoid limits by @junedkh
- Random Service Account for each task
### Status
- Clone Status
- Extract Status
- Archive Status
- Seed Status
- Status Pages for unlimited tasks
- Ability to cancel upload/clone/archive/extract/split
- Cancel all buttons for choosing specific tasks status to cancel
- Fix flooding issues
- Fix overall upload and download speed
### Yt-dlp
- Switch from youtube-dl to yt-dlp and fix all conflicts
- Yt-dlp quality buttons
- Support for download live streams
- Ability to use specific yt-dlp arg for each task
- Fix download progress
### Database
- SQL Database support
- Save leech settings including thumbnails in database
- Save sudo and authorized users
- Incomplete task notifier to get incomplete task messages after restart
### Torrents Search
- Torrent search support
- Search on torrents with Torrent Search API
- Search on torrents with variable plugins using qBittorrent search engine
### Archives
- Zip instead of tar
- Using 7-zip tool to extract all supported files
- Extract rar, zip and 7z within folder or splits with or without password
- Zip file/folder with or without password
### RSS
- Rss feed. Based on this repository [rss-chan](https://github.com/hyPnOtICDo0g/rss-chan)
- Filter added and all functions have been improved
### Overall
- Docker image support for linux `amd64, arm64/v8, arm/v7, s390x`
- Update bot at startup and with restart command using `UPSTREAM_REPO`
- Mirror/Leech/Watch/Clone/Count/Del by reply
- Mirror/Leech/Clone multi links/files with one command
- Custom name for all links except torrents. For files you should add extension except yt-dlp links
- Extensions Filter for the files to be uploaded/cloned
- View Link button. Extra button to open index link in broswer instead of direct download for file
- Almost all repository functions have been improved and many other details can't mention all of them
- Many bugs have been fixed

## From Base and other Repositories
- Mirror direct download links, Torrent, Mega.nz and Telegram files to Google Drive
- Copy files from someone's Drive to your Drive
- Download/Upload progress, Speeds and ETAs
- Mirror all youtube-dl supported links
- Docker support
- Uploading to Team Drive
- Index Link support
- Service Account support
- Delete files from Drive
- Multiple Trackers support
- Shell and Executor
- Add sudo users
- Extract password protected files
- Extract these filetypes
  > ZIP, RAR, TAR, 7z, ISO, WIM, CAB, GZIP, BZIP2, APM, ARJ, CHM, CPIO, CramFS, DEB, DMG, FAT, HFS, LZH, LZMA, LZMA2, MBR, MSI, MSLZ, NSIS, NTFS, RPM, SquashFS, UDF, VHD, XAR, Z, TAR.XZ
- Direct links Supported:
  >mediafire, letsupload.io, hxfile.co, anonfiles.com, bayfiles.com, antfiles, fembed.com, fembed.net, femax20.com, layarkacaxxi.icu, fcdn.stream, sbplay.org, naniplay.com, naniplay.nanime.in, naniplay.nanime.biz, sbembed.com, streamtape.com, streamsb.net, feurl.com, upload.ee, pixeldrain.com, racaty.net, 1fichier.com, 1drv.ms (Only works for file not folder or business account), uptobox.com and solidfiles.com

# How to deploy?

## Prerequisites

- Tutorial Video from A to Z:
  - Thanks to [Wiszky](https://github.com/vishnoe115)
 <p><a href="https://youtu.be/IUmq1paCiHI"> <img src="https://img.shields.io/badge/See%20Video-black?style=for-the-badge&logo=YouTube" width="160""/></a></p>

### 1. Installing requirements

- Clone this repo:
```
git clone https://github.com/anasty17/mirror-leech-telegram-bot mirrorbot/ && cd mirrorbot
```
- For Debian based distros
```
sudo apt install python3 python3-pip
```
Install Docker by following the [official Docker docs](https://docs.docker.com/engine/install/debian/)

- For Arch and it's derivatives:
```
sudo pacman -S docker python
```
- Install dependencies for running setup scripts:
```
pip3 install -r requirements-cli.txt
```

------

### 2. Setting up config file

```
cp config_sample.env config.env
```
- Remove the first line saying:
```
_____REMOVE_THIS_LINE_____=True
```
Fill up rest of the fields. Meaning of each field is discussed below:

**1. Required Fields**

- `BOT_TOKEN`: The Telegram Bot Token that you got from [@BotFather](https://t.me/BotFather). `Str`
- `GDRIVE_FOLDER_ID`: This is the Folder/TeamDrive ID of the Google Drive Folder or `root` to which you want to upload all the mirrors. `Str`
- `OWNER_ID`: The Telegram User ID (not username) of the Owner of the bot. `Int`
- `DOWNLOAD_DIR`: The path to the local folder where the downloads should be downloaded to. `Str`
- `DOWNLOAD_STATUS_UPDATE_INTERVAL`: Time in seconds after which the progress/status message will be updated. Recommended `10` seconds at least. `Int`
- `AUTO_DELETE_MESSAGE_DURATION`: Interval of time (in seconds), after which the bot deletes it's message and command message which is expected to be viewed instantly. **NOTE**: Set to `-1` to disable auto message deletion. `Int`
- `TELEGRAM_API`: This is to authenticate your Telegram account for downloading Telegram files. You can get this from https://my.telegram.org. `Int`
- `TELEGRAM_HASH`: This is to authenticate your Telegram account for downloading Telegram files. You can get this from https://my.telegram.org. `Str`

**2. Optional Fields**
- `IS_TEAM_DRIVE`: Set `True` if uploading to TeamDrive. Default is `False`. `Bool`
- `DATABASE_URL`: Your SQL Database URL. Follow this [Generate Database](https://github.com/anasty17/mirror-leech-telegram-bot/tree/master#generate-database) to generate database. Data will be saved in Database: auth and sudo users, leech settings including thumbnails for each user, rss data and incomplete tasks. **NOTE**: If deploying on heroku and using heroku postgresql delete this variable from **config.env** file. **DATABASE_URL** will be grabbed from heroku variables. `Str`
- `AUTHORIZED_CHATS`: Fill user_id and chat_id of groups/users you want to authorize. Separate them by space. `Str`
- `SUDO_USERS`: Fill user_id of users whom you want to give sudo permission. Separate them by space. `Str`
- `IGNORE_PENDING_REQUESTS`: Ignore pending requests after restart. Default is `False`. `Bool`
- `USE_SERVICE_ACCOUNTS`: Whether to use Service Accounts or not. For this to work see [Using Service Accounts](https://github.com/anasty17/mirror-leech-telegram-bot#generate-service-accounts-what-is-service-account) section below. Default is `False`. `Bool`
- `INDEX_URL`: Refer to https://gitlab.com/ParveenBhadooOfficial/Google-Drive-Index. `Str`
- `STATUS_LIMIT`: Limit the no. of tasks shown in status message with buttons. **NOTE**: Recommended limit is `4` tasks. `Str`
- `STOP_DUPLICATE`: Bot will check file in Drive, if it is present in Drive, downloading or cloning will be stopped. (**NOTE**: File will be checked using filename not file hash, so this feature is not perfect yet). Default is `False`. `Bool`
- `CMD_INDEX`: commands index number. This number will added at the end all commands. `Str`
- `TORRENT_TIMEOUT`: Timeout of dead torrents downloading with qBittorrent and Aria2c in seconds. `Str`
- `EXTENSION_FILTER`: File extensions that won't upload/clone. Separate them by space. `Str`
- `INCOMPLETE_TASK_NOTIFIER`: Get incomplete task messages after restart. Require database and superGroup. Default is `False`. `Bool`
- `UPTOBOX_TOKEN`: Uptobox token to mirror uptobox links. Get it from [Uptobox Premium Account](https://uptobox.com/my_account). `str`

### Update
- `UPSTREAM_REPO`: Your github repository link, if your repo is private add `https://username:{githubtoken}@github.com/{username}/{reponame}` format. Get token from [Github settings](https://github.com/settings/tokens). So you can update your bot from filled repository on each restart. `Str`.
  - **NOTE**: Any change in docker or requirements you need to deploy/build again with updated repo to take effect. DON'T delete .gitignore file. For more information read [THIS](https://github.com/anasty17/mirror-leech-telegram-bot/tree/master#upstream-repo-recommended).
- `UPSTREAM_BRANCH`: Upstream branch for update. Default is `master`. `Str`

### Leech
- `LEECH_SPLIT_SIZE`: Size of split in bytes. Default is `2GB`. Default is `4GB` if your account is premium. `Str`
- `AS_DOCUMENT`: Default type of Telegram file upload. Default is `False` mean as media. `Bool`
- `EQUAL_SPLITS`: Split files larger than **LEECH_SPLIT_SIZE** into equal parts size (Not working with zip cmd). Default is `False`. `Bool`
- `CUSTOM_FILENAME`: Add custom word to leeched file name. `Str`
- `DUMP_CHAT`: Chat ID. Upload files to specific chat. `str`. **NOTE**: Only available for superGroup/channel. Add `-100` before channel/superGroup id. In short don't add bot id or your id!
- `USER_SESSION_STRING`: To download/upload from your telegram account. If you own premium account. To generate session string use this command `python3 generate_string_session.py` after mounting repo folder for sure. `Str`. **NOTE**: You can't use bot with private message. Use it with superGroup.

### qBittorrent/Aria2c
- `BASE_URL_OF_BOT`: Valid BASE URL where the bot is deployed to use qbittorrent web selection. Format of URL should be `http://myip`, where `myip` is the IP/Domain(public) of your bot or if you have chosen port other than `80` so write it in this format `http://myip:port` (`http` and not `https`). This Var is optional on VPS and required for Heroku specially to avoid app sleeping/idling. For Heroku fill `https://yourappname.herokuapp.com`. Still got idling? You can use http://cron-job.org to ping your Heroku app. `Str`
- `SERVER_PORT`: Only For VPS, which is the **BASE_URL_OF_BOT** Port. `Str`
- `WEB_PINCODE`: If empty or `False` means no more pincode required while qbit web selection. `Bool`
  - **Qbittorrent NOTE**: If your facing ram exceeded issue then set limit for `MaxConnecs`, decrease `AsyncIOThreadsCount` in qbittorrent config and set limit of `DiskWriteCacheSize` to `32`.

### RSS
- `RSS_DELAY`: Time in seconds for rss refresh interval. Recommended `900` second at least. Default is `900` in sec. `Str`
- `RSS_COMMAND`: Choose command for the desired action. `Str`
- `RSS_CHAT_ID`: Chat ID where rss links will be sent. If using channel then add channel id. Add `-100` before channel id. `Str`
- `RSS_USER_SESSION_STRING`: To send rss links from your telegram account. Instead of adding bot to channel then linking the channel to group to get rss link since bot will not read command from itself or other bot. To generate session string use this command `python3 generate_string_session.py` after mounting repo folder for sure. `Str`. **NOTE**: Don't use same session string as `USER_SESSION_STRING`.
  - **RSS NOTE**: `DATABASE_URL` and `RSS_CHAT_ID` is required, otherwise all rss commands will not work. You must use bot in group. You can add the bot to a channel and link this channel to group so messages sent by bot to channel will be forwarded to group without using `RSS_USER_STRING_SESSION`.

### Private Files
- `ACCOUNTS_ZIP_URL`: Only if you want to load your Service Account externally from an Index Link or by any direct download link NOT webpage link. Archive the accounts folder to ZIP file. Fill this with the direct download link of zip file. `Str`. If index need authentication so add direct download as shown below:
  - `https://username:password@example.workers.dev/...`
- `TOKEN_PICKLE_URL`: Only if you want to load your **token.pickle** externally from an Index Link. Fill this with the direct link of that file. `Str`
- `MULTI_SEARCH_URL`: Check `drive_folder` setup [here](https://github.com/anasty17/mirror-leech-telegram-bot/tree/master#multi-search-ids). Write **drive_folder** file [here](https://gist.github.com/). Open the raw file of that gist, it's URL will be your required variable. Should be in this form after removing commit id: https://gist.githubusercontent.com/username/gist-id/raw/drive_folder. `Str`
- `YT_COOKIES_URL`: Youtube authentication cookies. Check setup [Here](https://github.com/ytdl-org/youtube-dl#how-do-i-pass-cookies-to-youtube-dl). Use gist raw link and remove commit id from the link, so you can edit it from gists only. `Str`
- `NETRC_URL`: To create .netrc file contains authentication for aria2c and yt-dlp. Use gist raw link and remove commit id from the link, so you can edit it from gists only. **NOTE**: After editing .nterc you need to restart the docker or if deployed on heroku so restart dyno in case your edits related to aria2c authentication. `Str`
  - **NOTE**: All above url variables used incase you want edit them in future easily without deploying again or if you want to deploy from public fork. If deploying using cli or private fork you can leave these variables empty add token.pickle, accounts folder, drive_folder, .netrc and cookies.txt directly to root but you can't update them without rebuild OR simply leave all above variables and use private UPSTREAM_REPO.

### MEGA
- `MEGA_API_KEY`: Mega.nz API key to mirror mega.nz links. Get it from [Mega SDK Page](https://mega.nz/sdk). `Str`
- `MEGA_EMAIL_ID`: E-Mail ID used to sign up on mega.nz for using premium account. `Str`
- `MEGA_PASSWORD`: Password for mega.nz account. `Str`

### Buttons
- `VIEW_LINK`: View Link button to open file Index Link in browser instead of direct download link, you can figure out if it's compatible with your Index code or not, open any video from you Index and check if its URL ends with `?a=view`. Compatible with [BhadooIndex](https://gitlab.com/ParveenBhadooOfficial/Google-Drive-Index) Code. Default is `False`. `Bool`

### Torrent Search
- `SEARCH_API_LINK`: Search api app link. Get your api from deploying this [repository](https://github.com/Ryuk-me/Torrent-Api-py). `Str`
  - Supported Sites:
  >1337x, Piratebay, Nyaasi, Torlock, Torrent Galaxy, Zooqle, Kickass, Bitsearch, MagnetDL, Libgen, YTS, Limetorrent, TorrentFunk, Glodls, TorrentProject and YourBittorrent
- `SEARCH_LIMIT`: Search limit for search api, limit for each site and not overall result limit. Default is zero (Default api limit for each site). `Str`
- `SEARCH_PLUGINS`: List of qBittorrent search plugins (github raw links). I have added some plugins, you can remove/add plugins as you want. Main Source: [qBittorrent Search Plugins (Official/Unofficial)](https://github.com/qbittorrent/search-plugins/wiki/Unofficial-search-plugins). `Str`

------

### 3. Getting Google OAuth API credential file and token.pickle

**NOTES**
- Old authentication changed, now we can't use bot or replit to generate token.pickle. You need OS with a browser.
- Windows users should install python3 and pip. You can find how to install and use them from google or from this [telegraph](https://telegra.ph/Create-Telegram-Mirror-Leech-Bot-by-Deploying-App-with-Heroku-Branch-using-Github-Workflow-12-06) from [Wiszky](https://github.com/vishnoe115) tutorial.
- You can ONLY open the generated link from `generate_drive_token.py` in local browser.

1. Visit the [Google Cloud Console](https://console.developers.google.com/apis/credentials)
2. Go to the OAuth Consent tab, fill it, and save.
3. Go to the Credentials tab and click Create Credentials -> OAuth Client ID
4. Choose Desktop and Create.
5. Publish your OAuth consent screen App to prevent **token.pickle** from expire
6. Use the download button to download your credentials.
7. Move that file to the root of mirrorbot, and rename it to **credentials.json**
8. Visit [Google API page](https://console.developers.google.com/apis/library)
9. Search for Google Drive Api and enable it
10. Finally, run the script to generate **token.pickle** file for Google Drive:
```
pip3 install google-api-python-client google-auth-httplib2 google-auth-oauthlib
python3 generate_drive_token.py
```
------

## Deploying on VPS

**IMPORTANT NOTES**:
1. You must set `SERVER_PORT` variable to `80` or any other port you want to use.
2. To clear the container (this will not affect on the image):
```
sudo docker container prune
```
3. To delete the images:
```
sudo docker image prune -a
```
4. Check the number of processing units of your machine with `nproc` cmd and times it by 4, then edit `AsyncIOThreadsCount` in qBittorrent.conf.
5. You can add `CONFIG_FILE_URL` variable using docker and docker-compose, google it.

------

### Deploying on VPS Using Docker

- Start Docker daemon (SKIP if already running):
```
sudo dockerd
```
- Build Docker image:
```
sudo docker build . -t mirror-bot
```
- Run the image:
```
sudo docker run -p 80:80 mirror-bot
```
- To stop the image:
```
sudo docker ps
```
```
sudo docker stop id
```

----

### Deploying on VPS Using docker-compose

**NOTE**: If you want to use port other than 80, change it in [docker-compose.yml](https://github.com/anasty17/mirror-leech-telegram-bot/blob/master/docker-compose.yml) also.

```
sudo apt install docker-compose
```
- Build and run Docker image:
```
sudo docker-compose up
```
- After editing files with nano for example (nano start.sh):
```
sudo docker-compose up --build
```
- To stop the image:
```
sudo docker-compose stop
```
- To run the image:
```
sudo docker-compose start
```
- Tutorial video from Tortoolkit repo for docker-compose and checking ports
<p><a href="https://youtu.be/c8_TU1sPK08"> <img src="https://img.shields.io/badge/See%20Video-black?style=for-the-badge&logo=YouTube" width="160""/></a></p>

------

## Deploying on Heroku
<p><a href="https://github.com/anasty17/mirror-leech-telegram-bot/tree/heroku"> <img src="https://img.shields.io/badge/Deploy%20Guide-blueviolet?style=for-the-badge&logo=heroku" width="170""/></a></p>

------

# Extras

## Bot commands to be set in [@BotFather](https://t.me/BotFather)

```
mirror - or /m Mirror
zipmirror - or /zm Mirror and upload as zip
unzipmirror - or /uzm Mirror and extract files
qbmirror - or /qm Mirror torrent using qBittorrent
qbzipmirror - or /qzm Mirror torrent and upload as zip using qb
qbunzipmirror - or /quzm Mirror torrent and extract files using qb
leech - or /l Leech
zipleech - or /zl Leech and upload as zip
unzipleech - or /uzl Leech and extract files
qbleech - or /ql Leech torrent using qBittorrent
qbzipleech - or /qzl Leech torrent and upload as zip using qb
qbunzipleech - or /quzl Leech torrent and extract using qb
clone - Copy file/folder to Drive
count - Count file/folder of Drive
ytdl - or /y Mirror yt-dlp supported link
ytdlzip - or /yz Mirror yt-dlp supported link as zip
ytdlleech - or /yl Leech through yt-dlp supported link
ytdlzipleech - or /yzl Leech yt-dlp support link as zip
leechset - Leech settings
setthumb - Set thumbnail
status - Get Mirror Status message
btsel - select files from torrent
rsslist - or /rl List all subscribed rss feed info
rssget - or /rg Get specific No. of links from specific rss feed
rsssub - or /rs Subscribe new rss feed
rssunsub - or /rus Unsubscribe rss feed by title
rssset - or /rst Rss Settings
list - Search files in Drive
search - Search for torrents with API
cancel - Cancel a task
cancelall - Cancel all tasks
del - Delete file/folder from Drive
log - Get the Bot Log
shell - Run commands in Shell
restart - Restart the Bot
stats - Bot Usage Stats
ping - Ping the Bot
help - All cmds with description
```
------

## UPSTREAM REPO (Recommended)

- `UPSTREAM_REPO` variable can be used for edit/add any file in repository.
- You can add private/public repository link to grab/overwrite all files from it.
- You can skip adding the privates files like token.pickle or accounts folder before deploying, also no need to add variables direct links except **config.env**, simply fill `UPSTREAM_REPO` private one in case you want to grab all files including private files.
- If you added private files while deploying and you have added private `UPSTREAM_REPO` and your private files in this private repository, so your private files will be overwritten from this repository. Also if you are using URL variables like `TOKEN_PICKLE_URL` then all files from those variables will override the private files that added before deploying or from private `UPSTREAM_REPO`.
- If you filled `UPSTREAM_REPO` with the official repository link, then be carefull incase any change in requirements.txt your bot will not start after restart. In this case you need to deploy again with updated code to install the new requirements or simply by changing the `UPSTREAM_REPO` to you fork link with that old updates.
- In case you you filled `UPSTREAM_REPO` with your fork link be carefull also if you fetched the commits from the official repository.
- The changes in your `UPSTREAM_REPO` will take affect only after restart.
- `UPSTREAM_BRANCH` don't ever fill heroku here.

------

## Bittorrent Seed

- Add `d:ratio:time` perfix along with leech or mirror cmd.
- Using `d` perfix alone will lead to use global options for aria2c or qbittorrent.

### Qbittorrent
- Global options: `MaxRatio` and `GlobalMaxSeedingMinutes` in qbittorrent.conf, `-1` means no limit, but you can cancel manually.
  - **NOTE**: Don't change `MaxRatioAction`.

### Aria2c
- Global options: `--seed-ratio` (0 means no limit) and `--seed-time` (0 means no seed) in aria.sh.

------

## Using Service Accounts for uploading to avoid user rate limit

>For Service Account to work, you must set `USE_SERVICE_ACCOUNTS` = "True" in config file or environment variables.
>**NOTE**: Using Service Accounts is only recommended while uploading to a Team Drive.

### 1. Generate Service Accounts. [What is Service Account?](https://cloud.google.com/iam/docs/service-accounts)
Let us create only the Service Accounts that we need.

**Warning**: Abuse of this feature is not the aim of this project and we do **NOT** recommend that you make a lot of projects, just one project and 100 SAs allow you plenty of use, its also possible that over abuse might get your projects banned by Google.

>**NOTE**: If you have created SAs in past from this script, you can also just re download the keys by running:
```
python3 gen_sa_accounts.py --download-keys $PROJECTID
```
>**NOTE:** 1 Service Account can upload/copy around 750 GB a day, 1 project can make 100 Service Accounts so you can upload 75 TB a day or clone 2 TB from each file creator (uploader email).

#### Two methods to create service accounts
Choose one of these methods

##### 1. Create Service Accounts in existed Project (Recommended Method)
- List your projects ids
```
python3 gen_sa_accounts.py --list-projects
```
- Enable services automatically by this command
```
python3 gen_sa_accounts.py --enable-services $PROJECTID
```
- Create Sevice Accounts to current project
```
python3 gen_sa_accounts.py --create-sas $PROJECTID
```
- Download Sevice Accounts as accounts folder
```
python3 gen_sa_accounts.py --download-keys $PROJECTID
```

##### 2. Create Service Accounts in New Project
```
python3 gen_sa_accounts.py --quick-setup 1 --new-only
```
A folder named accounts will be created which will contain keys for the Service Accounts.

### 2. Add Service Accounts

#### Two methods to add service accounts
Choose one of these methods

##### 1. Add Them To Google Group then to Team Drive (Recommended)
- Mount accounts folder
```
cd accounts
```
- Grab emails form all accounts to emails.txt file that would be created in accounts folder
- `For Windows using PowerShell`
```
$emails = Get-ChildItem .\**.json |Get-Content -Raw |ConvertFrom-Json |Select -ExpandProperty client_email >>emails.txt
```
- `For Linux`
```
grep -oPh '"client_email": "\K[^"]+' *.json > emails.txt
```
- Unmount acounts folder
```
cd ..
```
Then add emails from emails.txt to Google Group, after that add this Google Group to your Shared Drive and promote it to manager and delete email.txt file from accounts folder

##### 2. Add Them To Team Drive Directly
- Run:
```
python3 add_to_team_drive.py -d SharedTeamDriveSrcID
```
------

### Generate Database

**1. Using Railway**
- Go to [railway](https://railway.app) and create account
- Start new project
- Press on `Provision PostgreSQL`
- After creating database press on `PostgresSQL`
- Go to `Connect` column
- Copy `Postgres Connection URL` and fill `DATABASE_URL` variable with it

**2. Using Heroku PostgreSQL**
<p><a href="https://dev.to/prisma/how-to-setup-a-free-postgresql-database-on-heroku-1dc1"> <img src="https://img.shields.io/badge/See%20Dev.to-black?style=for-the-badge&logo=dev.to" width="160""/></a></p>

**3. Using ElephantSQL**
- Go to [elephantsql](https://elephantsql.com) and create account
- Hit `Create New Instance`
- Follow the further instructions in the screen
- Hit `Select Region`
- Hit `Review`
- Hit `Create instance`
- Select your database name
- Copy your database url, and fill `DATABASE_URL` variable with it

------

## Multi Search IDs
To use list from multi TD/folder. Run driveid.py in your terminal and follow it. It will generate **drive_folder** file or u can simply create `drive_folder` file in working directory and fill it, check below format:
```
DriveName folderID/tdID or `root` IndexLink(if available)
DriveName folderID/tdID or `root` IndexLink(if available)
```
-----

## Yt-dlp and Aria2c Authentication Using .netrc File
For using your premium accounts in yt-dlp or for protected Index Links, create .netrc file according to following format:

**Note**: Create .netrc and not netrc, this file will be hidden, so view hidden files to edit it after creation.

Format:
```
machine host login username password my_password
```
Example:
```
machine instagram login anas.tayyar password mypassword
```
**Instagram Note**: You must login even if you want to download public posts and after first try you must confirm that this was you logged in from different ip(you can confirm from phone app).

**Youtube Note**: For `youtube` authentication use [cookies.txt](https://github.com/ytdl-org/youtube-dl#how-do-i-pass-cookies-to-youtube-dl) file.

Using Aria2c you can also use built in feature from bot with or without username. Here example for index link without username.
```
machine example.workers.dev password index_password
```
Where host is the name of extractor (eg. instagram, Twitch). Multiple accounts of different hosts can be added each separated by a new line.

-----

## Donations

<p> If you feel like showing your appreciation for this project, then how about buying me a coffee.</p>

[!["Buy Me A Coffee"](https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png)](https://www.buymeacoffee.com/anasty17)

-----
